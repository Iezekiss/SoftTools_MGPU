# **Лабораторная работа №4**

## Анализ задержек авиарейсов и построение витрины данных в Airflow + PostgreSQL + Superset

---

## **1. Цель работы**

Целью работы является разработка конвейера обработки данных о задержках авиарейсов с использованием Airflow, формирование витрины данных в PostgreSQL и построение аналитического дашборда в Apache Superset. По итогам работы необходимо провести бизнес-анализ выявленных закономерностей и подготовить выводы.

---

## **2. Исследуемые метрики бизнес-процесса**

В рамках анализа рассматривались следующие метрики:

* **Доля задержанных рейсов** и динамика задержек.
* **Среднее время задержки прибытия (arrival_delay_minutes)**.
* **Распределение задержек по авиакомпаниям (airline)**.
* **Распределение по аэропортам вылета (origin_airport)**.
* **Количество рейсов по месяцам**.
* **Комбинированные показатели: связи частоты рейсов и количества задержек.**

---

## **3. Архитектура решения**

Архитектура решения включает три ключевых компонента:

1. **Airflow (DAG)**

   * автоматизированная загрузка и подготовка данных;
   * создание витрины данных в PostgreSQL;
   * выполнение SQL-скриптов и формирование таблиц.

2. **PostgreSQL**

   * хранение исходных данных;
   * хранение витрины данных (VIEW).

3. **Apache Superset**

   * подключение к витрине;
   * создание пяти визуализаций;
   * сборка итогового дашборда.

Схема обработки:

```
Raw Data → Airflow → PostgreSQL (VIEW) → Superset Dashboard → Аналитика
```

---

## **4. Технологический стек**

В работе использованы:

* **Python 3.9**
* **Apache Airflow**
* **PostgreSQL**
* **Docker Compose**
* **Apache Superset**
* **Pandas, Matplotlib**
* **SQLAlchemy**
* **VS Code**

---

## **5. ER-диаграмма базы данных (PostgreSQL)**

Для решения использована упрощённая структура, включающая:

```
flights (исходные данные)
↓
view_flights_delays (витрина)
```

ER-диаграмма:

```
┌─────────────────────────────┐
│         flights              │
├─────────────────────────────┤
│ flight_id (PK)              │
│ month                       │
│ airline                     │
│ origin_airport              │
│ arrival_delay_minutes       │
│ ...                         │
└───────────────┬─────────────┘
                │ 1:1
┌───────────────▼─────────────┐
│  view_flights_delays (VIEW) │
├─────────────────────────────┤
│ month                       │
│ airline                     │
│ origin_airport              │
│ arrival_delay_minutes       │
│ is_delayed (int)            │
└─────────────────────────────┘
```

---

## **6. Git-репозиторий**

Репозиторий содержит:

* **DAG:** `/dags/analysis_dag.py`
* **SQL-витрина:** `/sql/create_view.sql`
* **JSON-дашборд:** `/dashboard/dashboard.json` *(или ссылка на опубликованный дашборд)*

---

## **7. Описание проделанной работы**

### **7.1. Скриншот выполненного DAG в Airflow**

*(вставляется изображение графа DAG)*

> DAG успешно выполнил загрузку данных, создание витрины и передал таблицу для визуализации.

---

### **7.2. SQL-запрос витрины данных**

```sql
CREATE OR REPLACE VIEW view_flights_delays AS
SELECT
    month,
    airline,
    origin_airport,
    arrival_delay_minutes,
    CASE
        WHEN arrival_delay_minutes > 0 THEN 1
        ELSE 0
    END AS is_delayed
FROM flights;
```

---

### **7.3. Скриншот итогового дашборда Superset**

Дашборд включает:

1. **Indicator chart:** общий % задержанных рейсов.
2. **Bar chart:** % задержек по авиакомпаниям.
3. **Pie chart:** доля рейсов по авиакомпаниям.
4. **Mixed chart:** количество рейсов + % задержек по месяцам.
5. **Line chart:** среднее время задержки по месяцам.
6. **Фильтры:** airline, month, origin_airport.

*(вставляется изображение дашборда)*

---

## **8. Выводы по анализу**

На основе созданного дашборда можно сделать следующие аналитические выводы:

* **Общая доля задержанных рейсов остаётся значимой**, что указывает на системные причины (расписание, погодные условия, операционные процессы).
* **Разные авиакомпании демонстрируют различный уровень задержек.** Это позволяет формировать рейтинг надёжности перевозчиков.
* **Есть месяцы с повышенной нагрузкой**, где наблюдается рост задержек, что может быть связано с сезонными факторами.
* **Аэропорты вылета отличаются по уровню средней задержки**, что показывает влияние локальной инфраструктуры и логистики.
* **Среднее время задержек варьируется по сезонам**, что можно учитывать при планировании рейсов и коммуникации с пассажирами.

---

## **9. Общий вывод**

В ходе работы построен полноценный ETL-конвейер для анализа задержек авиарейсов: данные обработаны в Airflow, витрина сформирована в PostgreSQL, а визуализации собраны в Superset. Полученный дашборд позволяет выявить ключевые проблемные зоны, сравнить авиакомпании, оценить динамику задержек и получить прямые бизнес-инсайты для оптимизации расписаний и управления операционной нагрузкой.
